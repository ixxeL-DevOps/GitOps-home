---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: github-pull-hydrator
  namespace: argocd
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: admin
  target:
    name: github-pull-hydrator
    creationPolicy: Owner
    deletionPolicy: Retain
    template:
      engineVersion: v2
      metadata:
        labels:
          argocd.argoproj.io/secret-type: repository
      data:
        username: ixxel
        password: "{{ .token }}"
        url: https://github.com/ixxeL-DevOps/GitOps-apps.git
        type: git
        project: argocd
  data:
  - secretKey: token
    remoteRef:
      key: github
      property: DEVOPS_ORG_PAT
      conversionStrategy: Default
      decodingStrategy: None
      metadataPolicy: None
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: github-push-hydrator
  namespace: argocd
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: admin
  target:
    name: github-push-hydrator
    creationPolicy: Owner
    deletionPolicy: Retain
    template:
      engineVersion: v2
      metadata:
        labels:
          argocd.argoproj.io/secret-type: repository-write
      data:
        username: ixxel
        password: "{{ .token }}"
        url: https://github.com
        type: git
        project: argocd
  data:
  - secretKey: token
    remoteRef:
      key: github
      property: DEVOPS_ORG_PAT
      conversionStrategy: Default
      decodingStrategy: None
      metadataPolicy: None

# ---
# apiVersion: external-secrets.io/v1beta1
# kind: ExternalSecret
# metadata:
#   name: github-app-repocreds
#   namespace: argocd
# spec:
#   secretStoreRef:
#     kind: ClusterSecretStore
#     name: admin
#   target:
#     name: github-app-repocreds
#     creationPolicy: Owner
#     deletionPolicy: Retain
#     template:
#       engineVersion: v2
#       metadata:
#         labels:
#           argocd.argoproj.io/secret-type: repo-creds
#       data:
#         url: https://github.com
#         type: git
#         githubAppID: "{{ .appid }}"
#         githubAppInstallationID: "{{ .installid }}"
#         githubAppPrivateKey: |-
#           "{{ .privatekey }}"
#   data:
#   - secretKey: appid
#     remoteRef:
#       key: github
#       property: GH_APP_ARGOCD_ID
#       conversionStrategy: Default
#       decodingStrategy: None
#       metadataPolicy: None
#   - secretKey: installid
#     remoteRef:
#       key: github
#       property: GH_APP_ARGOCD_INSTALL_ID
#       conversionStrategy: Default
#       decodingStrategy: None
#       metadataPolicy: None
#   - secretKey: privatekey
#     remoteRef:
#       key: github
#       property: GH_APP_ARGOCD_PRIVATE_KEY
#       conversionStrategy: Default
#       decodingStrategy: Base64
#       metadataPolicy: None
# ---
# apiVersion: external-secrets.io/v1beta1
# kind: ExternalSecret
# metadata:
#   name: github-app-hydrator
#   namespace: argocd
# spec:
#   secretStoreRef:
#     kind: ClusterSecretStore
#     name: admin
#   target:
#     name: github-app-hydrator
#     creationPolicy: Owner
#     deletionPolicy: Retain
#     template:
#       engineVersion: v2
#       metadata:
#         labels:
#           argocd.argoproj.io/secret-type: repository-write
#       data:
#         url: https://github.com
#         type: git
#         githubAppID: "{{ .appid }}"
#         githubAppInstallationID: "{{ .installid }}"
#         githubAppPrivateKey: |-
#           "{{ .privatekey }}"
#   data:
#   - secretKey: appid
#     remoteRef:
#       key: github
#       property: GH_APP_ARGOCD_ID
#       conversionStrategy: Default
#       decodingStrategy: None
#       metadataPolicy: None
#   - secretKey: installid
#     remoteRef:
#       key: github
#       property: GH_APP_ARGOCD_INSTALL_ID
#       conversionStrategy: Default
#       decodingStrategy: None
#       metadataPolicy: None
#   - secretKey: privatekey
#     remoteRef:
#       key: github
#       property: GH_APP_ARGOCD_PRIVATE_KEY
#       conversionStrategy: Default
#       decodingStrategy: Base64
#       metadataPolicy: None
